function ais_client(e){this.callbacks={bounce:this._nullhandler,echo_response:this._nullhandler,chooser:this._nullhandler,init:this._nullhandler,identity:this._nullhandler,logout_result:this._nullhandler,becomes_authenticated:this._nullhandler,becomes_unauthenticated:this._nullhandler,authz_query:this._nullhandler,resources:this._nullhandler,device:this._nullhandler,vcs:this._nullhandler,vcs_list:this._nullhandler,authz_query_list:this._nullhandler},this.baseurl="idp.securetve.com/rest/1.0/",this.responsefield=e,this.authstate=!1,this.platform_id="",this.aisuid="",this.use_logging=!1,this.log_target="",this.use_cache=!0,this.response_cache={},this.cache_time={init:3e4,chooser:3e4,authz_query:3e4,identity:3e4,bounce:2e3,echo_response:3e4,vcs:2e3,vcs_list:5e3,resources:3e4,authz_query_list:3e4},this.script_insert_type="",this.log_toggle=0,this.supportsLocalStorage=void 0,this.ls_prepend="AIS_client___",this.language_override="",this.protocol="http:"==window.location.protocol||"https:"==window.location.protocol?window.location.protocol+"//":"http://",this.log_object={},this.log_object_keys=[],this.log_object_size=20}ais_client.prototype.assignhandler=function(e,t){this._isFunction(t)?this.callbacks[e]=t:this.log("unable to assign handler to callback type ("+e+") because it is not callable",!0)},ais_client.prototype.setPlatformId=function(e){this.platform_id!=e&&this._reset_cache(!0),this.platform_id=e,this.log("setPlatformId ("+this.platform_id+")",!0)},ais_client.prototype.setLanguageOverride=function(e){this.language_override=e,this.log("setLanguageOverride ("+this.language_override+")",!0)},ais_client.prototype.setProtocol=function(e){this.protocol=e,this.log("setProtocol ("+this.protocol+")",!0)},ais_client.prototype.setResponsefield=function(e){this.responsefield=e,this.log("setResponsefield ("+this.responsefield+")",!0)},ais_client.prototype.aisresponse=function(e){if(void 0!==e.authenticated&&this.authstate!==this._mkboolean(e.authenticated)&&(this.authstate=this._mkboolean(e.authenticated),this._reset_cache(),this.authstate?(this.log("Authenticated",!0),this._dispatch("becomes_authenticated",e)):(this.log("Not Authenticated",!0),this._dispatch("becomes_unauthenticated",e))),void 0!==e.authorization&&(this._mkboolean(e.authorization)?this.log("Authorized: "+e.resource,!0):this.log("Not Authorized: "+e.resource,!0)),void 0!==e.aisuid?(this.aisuid=e.aisuid,this.log("Init: AISUID - "+this.aisuid,!0)):void 0!==e.identity&&(this.aisuid=e.identity.aisuid,this.log("Identity: AISUID - "+this.aisuid,!0)),this._set_cache(e),"authz_query_list"==e._type||"vcs_list"==e._type)for(i=0;e.documents.length>i;i++)this._set_cache(e.documents[i]);"logout_result"==e._type&&(this.log("aisresponse: clearing cache",!0),this._reset_cache(!0));var t=e._type;this._dispatch(t,e)},ais_client.prototype.bounce=function(e){this.log("bounce ",!0),(1==e||0==this._use_cache("bounce"))&&this._call_ais("bounce")},ais_client.prototype.echo=function(e,t){this.log("echo ",!0),(1==t||0==this._use_cache("echo_response",e))&&this._call_ais("echo",e)},ais_client.prototype.init=function(e){this.log("init: ("+(1==this.authstate?"init":"chooser")+")",!0),(1==e||0==this._use_cache(1==this.authstate?"init":"chooser"))&&this._call_ais("init")},ais_client.prototype.chooser=function(e){this.log("chooser ",!0),(1==e||0==this._use_cache("chooser"))&&this._call_ais("chooser")},ais_client.prototype.init_increaseScope=function(e){this.log("init_increaseScope DEPRECATED, using chooser",!0),(1==e||0==this._use_cache("chooser"))&&this._call_ais("chooser")},ais_client.prototype.identity=function(e){this.log("identity ",!0),(1==e||0==this._use_cache("identity"))&&this._call_ais("identity")},ais_client.prototype.logout=function(){this.log("logout ",!0),this._reset_cache(),this._call_ais("logout")},ais_client.prototype.resourceAccess=function(e,t){this.log("resourceAccess: "+e,!0),(1==t||0==this._use_cache("authz_query",e))&&this._call_ais("resourceAccess",e)},ais_client.prototype.resourceAccessList=function(e,t){this.log("resourceAccessList: "+e.join(","),!0),void 0==e||"object"!=typeof e?this.log("resourceAccessList: no resourceid_array provided"+("object"!=typeof e),!0):(1==t||0==this._use_cache("authz_query_list",e))&&this._call_ais("resourceAccessList",e)},ais_client.prototype.channelAccess=function(e,t){this.log("channelAccess: "+e,!0),(1==t||0==this._use_cache("authz_query",e))&&this._call_ais("channelAccess",e)},ais_client.prototype.resources=function(e){this.log("resources ",!0),(1==e||0==this._use_cache("resources"))&&this._call_ais("resources")},ais_client.prototype.registerDevice=function(e){this.log("registerDevice ",!0),this._call_ais("registerDevice",e)},ais_client.prototype.vcsGet=function(e,t){this.log("vcsGet: "+e,!0),void 0==e||""==e?this.log("vcsGet: no contentid provided",!0):(1==t||0==this._use_cache("vcs",e))&&this._call_ais("vcsGet",e)},ais_client.prototype.vcsSet=function(e,t){this.log("vcsSet: "+e+","+t,!0),this._call_ais("vcsSet",e,t)},ais_client.prototype.vcsList=function(e,t){this.log("vcsList: "+(void 0!=e?e.join(","):"no contentid_array"),!0),(1==t||0==this._use_cache("vcs_list",e))&&this._call_ais("vcsList",e)},ais_client.prototype.vcsListRecent=function(e,t){this.log("vcsListRecent: "+e,!0),(1==t||0==this._use_cache("vcs_list",e))&&this._call_ais("vcsListRecent",e)},ais_client.prototype.loginFormat=function(e,t){var s=this._getResourceUrl(this.baseurl,this.protocol,this.platform_id);return s+"/init/"+e+"?responsemethod=redirect&format=jsonp"+(void 0!=t&&""!=t?"&responsetarget="+t:"")+(""!=this.language_override?"&lang="+this.language_override:"")},ais_client.prototype.logoutFormat=function(e){var t=this._getResourceUrl(this.baseurl,this.protocol,this.platform_id);return t+"/slo/?responsemethod=redirect&format=jsonp"+(void 0!=e?"&responsetarget="+e:"")},ais_client.prototype.login=function(e){this.log("ais_client.login DEPRECATED. Use ais_client.loginFormat instead.",!0);var t=this._getResourceUrl(this.baseurl,this.protocol,this.platform_id);return t+"/init/"+e+"?format=jsonp"},ais_client.prototype.setLogging=function(e,t){1==e?(this.use_logging=e,this.log("setLogging: Logging enabled ("+(void 0!=t&&document.getElementById(t)?"HTML - "+t:"console.log")+")",!0)):(this.log("setLogging: Logging disabled",!0),this.use_logging=e),void 0!=t?document.getElementById(t)&&(this.log_target=t):this.log_target=""},ais_client.prototype.setCacheTime=function(e,t){var s=!1;if("number"==typeof t)switch(e){case"init":case"chooser":case"authz_query":case"identity":case"bounce":case"echo_response":case"vcs":case"resources":case"vcs_list":case"authz_query_list":this.cache_time[e]=t,s=!0}return this.log("setCache ("+e+","+t+") "+(1==s?"changed successfully":"invalid call"),!0),this.log(this.cache_time),s},ais_client.prototype.setUseCache=function(e){1!=e&&0!=e||e==this.use_cache||(this.use_cache=e,this.log("setUseCache: changed to (use_cache="+e+")",!0)),this.log("setUseCache: (use_cache="+this.use_cache+")",!0)},ais_client.prototype.setScriptInsert=function(e){this.script_insert_type="","jquery"==e&&(this.script_insert_type=e),this.log("setScriptInsert ("+e+")",!0)},ais_client.prototype.setRedirectLocation=function(e){this.log("setRedirectLocation ("+e+")",!0),this._set("ais_client_redirect_location",e)},ais_client.prototype.getRedirectLocation=function(){return this.log("getRedirectLocation ("+this._get("ais_client_redirect_location")+")",!0),this._get("ais_client_redirect_location")},ais_client.prototype.clearRedirectLocation=function(){this._clear("ais_client_redirect_location"),this.log("clearRedirectLocation",!0)},ais_client.prototype.log=function(e,t){var s="";if(s=1==t?"[AIS] "+e:e,this.log_object_keys.length>=this.log_object_size){var i=this.log_object_keys.shift();delete this.log_object[i]}var o=new Date,c=o.getFullYear()+"-"+o.getMonth()+"-"+o.getDate()+" "+o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+"."+o.getMilliseconds();if(this.log_object[c]=s,this.log_object_keys[this.log_object_keys.length]=c,1==this.use_logging&&(window.console&&console.log&&console.log(s),""!=this.log_target)){var r="";"object"==typeof e&&(r+="<br>",r+=this._create_object_log_output(e),s="[AIS] "+s+r),document.getElementById(this.log_target).innerHTML+="<div"+(0==this.log_toggle?"":' style="background: #E8E8E8;"')+">"+s+"</div>",this.log_toggle=1==this.log_toggle?0:1}},ais_client.prototype._call_ais=function(e,t,s){var i;if(i=this._getResourceUrl(this.baseurl,this.protocol,this.platform_id),"echo"==e?i+="/echo/"+t:"bounce"==e?i+="/bounce/":"init"==e?i+="/init/":"chooser"==e?i+="/chooser/":"identity"==e?i+="/identity/":"resourceAccess"==e?i+="/identity/resourceAccess/"+t:"channelAccess"==e?i+="/identity/channelAccess/"+t:"resources"==e?i+="/identity/resourceAccess/":"registerDevice"==e?i+="/identity/registerDevice/"+t:"vcsGet"==e?i+="/vcs/"+t:"vcsList"==e?i+="/vcs/":"vcsListRecent"==e?i+="/vcs/":"vcsSet"==e?i+="/vcs/"+t:"resourceAccessList"==e&&(i+="/identity/resourceAccess/"),i+="?format=jsonp&responsefield="+this.responsefield,"vcsSet"==e&&(i+="&ph_pos="+s+"&trickmode=post"),"vcsList"==e&&void 0!=t&&null!=t&&""!=t&&(i+="&content_id="+t.join("&content_id=")),"vcsListRecent"==e&&void 0!=t&&null!=t&&""!=t&&(i+="&limit="+t),"resourceAccessList"==e&&(i+="&resource_id="+t.join("&resource_id=")),""==this.language_override||"resourceAccess"!=e&&"channelAccess"!=e&&"resourceAccessList"!=e||(i+="&lang="+this.language_override),this.log(e+": "+i,!0),"jquery"==this.script_insert_type)(function(e){e.ajax({url:i,dataType:"script",cache:!0,async:!0})})(jQuery);else{var o=document.createElement("script");o.setAttribute("src",i),document.getElementsByTagName("head")[0].appendChild(o)}},ais_client.prototype._mkboolean=function(e){return/^true$/i.test(e)},ais_client.prototype._isFunction=function(e){return!!e&&e.constructor==Function},ais_client.prototype._nullhandler=function(){},ais_client.prototype._alerthandler=function(e,t){alert("alert handler received message of type: "+e+"\n with: "+t,!0)},ais_client.prototype._dispatch=function(e,t){void 0!==this.callbacks[e]&&this._isFunction(this.callbacks[e])?(runner=this.callbacks[e],runner(e,t)):this.log("callable is not set for handler: "+e,!0)},ais_client.prototype._create_object_log_output=function(e){var t="";t="{";for(key in e)"object"==typeof e[key]?(t+=""+("string"==typeof key?'"'+key+'"':key)+":",t+=this._create_object_log_output(e[key]),t+=", "):t+=""+("string"==typeof key?'"'+key+'"':key)+":"+("string"==typeof e[key]?'"'+e[key]+'"':e[key])+", ";return t=t.substring(0,t.length-2),t+="}"},ais_client.prototype._use_cache=function(e){var t=!1;if(0==this.use_cache)return this.log("_use_cache: caching disabled",!0),t;var s=0,i="",o=new Date,c=e;"authz_query"==c||"vcs"==c?c+="-"+arguments[1]:"echo_response"==c?c+="-"+escape(arguments[1]):"vcs_list"==c&&(c+="-"+("object"!=typeof arguments[1]?arguments[1]:arguments[1].join("-")));var r=void 0;return 1==this.supportsLocalStorage&&(r=localStorage.getItem(this.ls_prepend+this.platform_id+"__"+"response_cache_update__"+c)),void 0!==this.response_cache._response_cache_updates[c]?(s=this.response_cache._response_cache_updates[c],i="js"):void 0!=r&&(s=r,i="localStorage"),s>0&&this.cache_time[e]>o.getTime()-s?("js"==i?window[this.responsefield+"(this.response_cache[response_call],true)"]:"localStorage"==i&&window[this.responsefield+'(JSON.parse(localStorage.getItem(this.ls_prepend+this.platform_id+"__"+response_call)),true)'],t=!0,this.log("_use_cache: "+c+" ("+i+" cached "+(this.cache_time[e]-(o.getTime()-s))+"/"+this.cache_time[e]+")",!0)):(t=!1,1==this.supportsLocalStorage&&(localStorage.removeItem(this.ls_prepend+this.platform_id+"__"+"response_cache_update__"+c),localStorage.removeItem(this.ls_prepend+this.platform_id+"__"+c))),t},ais_client.prototype._set_cache=function(e){var t=new Date,s=e._type;if("authz_query"==s)s=e._type+"-"+e.resource;else if("echo_response"==s)s+="-"+escape(e.response_value);else if("vcs"==s)s+="-"+escape(e.content_id);else if("vcs_list"==s)for(i=0;e.documents.length>i;i++)s+="-"+e.documents[i].content_id;if(void 0===this.response_cache[s]||t.getTime()-this.response_cache._response_cache_updates[s]>this.cache_time[e._type]){var o=void 0;1==this.supportsLocalStorage&&(o=localStorage.getItem(this.ls_prepend+this.platform_id+"__"+"response_cache_update__"+s)),this.response_cache._response_cache_updates[s]=void 0!=o?o:t.getTime(),1==this.supportsLocalStorage&&localStorage.setItem(this.ls_prepend+this.platform_id+"__"+"response_cache_update__"+s,t.getTime())}this.response_cache[s]=e,1==this.supportsLocalStorage&&localStorage.setItem(this.ls_prepend+this.platform_id+"__"+s,JSON.stringify(e)),this.log("_set_cache: "+s+" (caching length = "+this.cache_time[e._type]+")",!0),this.log(this.response_cache)},ais_client.prototype._reset_cache=function(e){if(this.response_cache={_response_cache_updates:{}},1==e&&1==this.supportsLocalStorage){var t=[];for(i=0;localStorage.length-1>=i;i++)t[i]=localStorage.key(i);var s=this.ls_prepend+this.platform_id+"__";for(i=0;t.length-1>=i;i++)t[i].substring(0,s.length)==s&&(this.log("_reset_cache: Removing| "+t[i],!0),localStorage.removeItem(t[i]))}},ais_client.prototype._set=function(e,t){if(1==this.supportsLocalStorage)return this.log('_set: using localStorage (key: "'+e+'", value: "'+t+'")',!0),localStorage.removeItem(e),localStorage.setItem(e,escape(t));var s="";if(arguments[2]){var i=new Date;i.setTime(i.getTime()+1e3*60*60*24*arguments[2]),s="; expires="+i.toGMTString()}return document.cookie=e+"="+escape(t)+s+"; path=/",this.log('_set: using cookies (key: "'+e+'", value: "'+t+'", expires: "'+s+'", cookie_value: "'+e+"="+t+s+"; path=/"+'")',!0),void 0},ais_client.prototype._get=function(e){if(1==this.supportsLocalStorage)return this.log('_get: using localStorage (key: "'+e+'", value: "'+localStorage.getItem(e)+'")',!0),unescape(localStorage.getItem(e));for(var t=e+"=",s=document.cookie.split(";"),i=0;s.length>i;i++){for(var o=s[i];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return this.log('_get: using cookies (key: "'+e+'", value: "'+o.substring(t.length,o.length)+'")',!0),unescape(o.substring(t.length,o.length))}return null},ais_client.prototype._clear=function(e){1==this.supportsLocalStorage?localStorage.removeItem(e):this._set(e,"",-1)},ais_client.prototype._setLocalStorageSupport=function(){this.supportsLocalStorage=this.__checkLocalStorageSupport()},ais_client.prototype.__checkLocalStorageSupport=function(){try{return JSON.stringify({a:"b"}),"localStorage"in window&&null!==window.localStorage}catch(e){return!1}},ais_client.prototype._getResourceUrl=function(e,t,s){var i;return i=e.indexOf(t)>=0?e+s:t+e+s};